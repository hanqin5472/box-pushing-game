<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ¨ç®±å­å°æ¸¸æˆ - 10å…³å¡ä¸“ä¸šç‰ˆ</title>
  <style>
    body {
      font-family: 'Microsoft YaHei', sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      background-color: #f5f5f5;
      margin: 0;
      padding: 20px;
    }
    h1 {
      color: #333;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
      margin-bottom: 5px;
    }
    .subtitle {
      color: #666;
      margin-top: 0;
      margin-bottom: 20px;
    }
    #game-container {
      background-color: #fff;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      padding: 20px;
      margin-bottom: 20px;
    }
    #game-board {
      margin: 0 auto;
      border: 2px solid #ddd;
    }
    .row {
      display: flex;
    }
    .cell {
      width: 50px;
      height: 50px;
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
    }
    .floor { background-color: #f9f3e6; }
    .wall { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50"><rect width="50" height="50" fill="%23755d44"/><rect x="5" y="5" width="40" height="40" fill="%2397866e"/></svg>'); }
    .player { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50"><circle cx="25" cy="25" r="20" fill="%23e74c3c"/><circle cx="25" cy="15" r="5" fill="%23fff"/></svg>'); }
    .box { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50"><rect x="10" y="10" width="30" height="30" fill="%23e67e22" stroke="%23d35400" stroke-width="2"/></svg>'); }
    .target { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50"><circle cx="25" cy="25" r="12" fill="none" stroke="%233498db" stroke-width="3" stroke-dasharray="4,2"/></svg>'); }
    .box-on-target { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50"><rect x="10" y="10" width="30" height="30" fill="%232ecc71" stroke="%2327ae60" stroke-width="2"/></svg>'); }
    #controls {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      margin-top: 15px;
    }
    .control-row {
      display: flex;
      gap: 8px;
    }
    button {
      width: 50px;
      height: 50px;
      font-size: 20px;
      background-color: #3498db;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
    }
    button:hover {
      background-color: #2980b9;
      transform: scale(1.05);
    }
    #stats {
      display: flex;
      justify-content: space-around;
      width: 100%;
      margin-top: 10px;
      color: #555;
    }
    #reset-btn {
      width: auto;
      padding: 0 15px;
      background-color: #e74c3c;
      margin-top: 10px;
    }
    #reset-btn:hover {
      background-color: #c0392b;
    }
    #message {
      margin-top: 15px;
      padding: 8px 15px;
      background-color: #2ecc71;
      color: white;
      border-radius: 5px;
      display: none;
      text-align: center;
    }
    .level-selector {
      margin-top: 15px;
    }
    select {
      padding: 5px 10px;
      border-radius: 4px;
      border: 1px solid #ccc;
    }
  </style>
</head>
<body>
  <h1>æ¨ç®±å­å°æ¸¸æˆ</h1>
  <p class="subtitle">ä¸“ä¸šç‰ˆ - 10ä¸ªç²¾å¿ƒè®¾è®¡å…³å¡</p>
  
  <div id="game-container">
    <div id="game-board"></div>
    <div id="stats">
      <div>å…³å¡: <span id="current-level">1</span>/<span id="total-levels">10</span></div>
      <div>æ­¥æ•°: <span id="move-count">0</span></div>
      <div>æœ€ä½³: <span id="best-score">-</span></div>
    </div>
    <div id="message"></div>
  </div>
  
  <div id="controls">
    <div class="control-row">
      <button id="up-btn" onclick="movePlayer(-1, 0)">â†‘</button>
    </div>
    <div class="control-row">
      <button id="left-btn" onclick="movePlayer(0, -1)">â†</button>
      <button id="right-btn" onclick="movePlayer(0, 1)">â†’</button>
    </div>
    <div class="control-row">
      <button id="down-btn" onclick="movePlayer(1, 0)">â†“</button>
    </div>
    <button id="reset-btn" onclick="resetLevel()">é‡ç½®å…³å¡</button>
    <div class="level-selector">
      é€‰æ‹©å…³å¡: 
      <select id="level-select" onchange="changeLevel()">
        <option value="0">1 - æ–°æ‰‹å…¥é—¨</option>
        <option value="1">2 - åŸºç¡€è®­ç»ƒ</option>
        <option value="2">3 - è¿·å®«æŒ‘æˆ˜</option>
        <option value="3">4 - å¯¹ç§°ä¹‹ç¾</option>
        <option value="4">5 - å¤šç®±éš¾é¢˜</option>
        <option value="5">6 - ç‹­çª„é€šé“</option>
        <option value="6">7 - å¤æ‚å¸ƒå±€</option>
        <option value="7">8 - éšè—è·¯å¾„</option>
        <option value="8">9 - å¤§å¸ˆçº§</option>
        <option value="9">10 - ç»ˆææŒ‘æˆ˜</option>
      </select>
    </div>
  </div>

  <script>
    // 10ä¸ªç²¾å¿ƒè®¾è®¡çš„å…³å¡
    const levels = [
      { // ç¬¬1å…³ - æ–°æ‰‹å…¥é—¨
        name: "æ–°æ‰‹å…¥é—¨",
        map: [
          '########',
          '#    @ #',
          '# $$ * #',
          '#   *  #',
          '#   #  #',
          '########'
        ],
        width: 8, height: 6
      },
      { // ç¬¬2å…³ - åŸºç¡€è®­ç»ƒ
        name: "åŸºç¡€è®­ç»ƒ", 
        map: [
          ' ###### ',
          '##    ##',
          '# $  $ #',
          '#  @   #',
          '## * *##',
          ' #    # ',
          ' ###### '
        ],
        width: 8, height: 7
      },
      { // ç¬¬3å…³ - è¿·å®«æŒ‘æˆ˜
        name: "è¿·å®«æŒ‘æˆ˜",
        map: [
          '#########',
          '#   #   #',
          '# $###$ #',
          '# * @ * #',
          '# $###$ #',
          '#   #   #',
          '#########'
        ],
        width: 9, height: 7
      },
      { // ç¬¬4å…³ - å¯¹ç§°ä¹‹ç¾
        name: "å¯¹ç§°ä¹‹ç¾",
        map: [
          '  #####  ',
          '###   ###',
          '#  $@$  #',
          '# * # * #',
          '#  $ $  #',
          '### * ###',
          '  #####  '
        ],
        width: 9, height: 7
      },
      { // ç¬¬5å…³ - å¤šç®±éš¾é¢˜
        name: "å¤šç®±éš¾é¢˜",
        map: [
          '#########',
          '#  ***  #',
          '#  $$$  #',
          '#   #   #',
          '#   @   #',
          '#########'
        ],
        width: 9, height: 6
      },
      { // ç¬¬6å…³ - ç‹­çª„é€šé“
        name: "ç‹­çª„é€šé“",
        map: [
          '#######',
          '#*#*#*#',
          '# $ $ #',
          '# ### #',
          '# @   #',
          '#######'
        ],
        width: 7, height: 6
      },
      { // ç¬¬7å…³ - å¤æ‚å¸ƒå±€
        name: "å¤æ‚å¸ƒå±€",
        map: [
          '  ######  ',
          '###    ###',
          '#   $$   #',
          '# # ## # #',
          '# * @ * * #',
          '###    ###',
          '  ######  '
        ],
        width: 10, height: 7
      },
      { // ç¬¬8å…³ - éšè—è·¯å¾„
        name: "éšè—è·¯å¾„",
        map: [
          '##########',
          '#  #     #',
          '# $*# $$ #',
          '#  #  @  #',
          '# $*# $$ #',
          '#  #  *  #',
          '##########'
        ],
        width: 10, height: 7
      },
      { // ç¬¬9å…³ - å¤§å¸ˆçº§
        name: "å¤§å¸ˆçº§",
        map: [
          '#########',
          '#*** ***#',
          '# $ $ $ #',
          '#   #   #',
          '# $ # $ #',
          '#   @   #',
          '#########'
        ],
        width: 9, height: 7
      },
      { // ç¬¬10å…³ - ç»ˆææŒ‘æˆ˜
        name: "ç»ˆææŒ‘æˆ˜",
        map: [
          ' ######## ',
          '##     ##',
          '# $###$ #',
          '# * * * #',
          '# $###$ #',
          '#  @    #',
          '#########'
        ],
        width: 10, height: 7
      }
    ];

    // æ¸¸æˆçŠ¶æ€
    let currentLevel = 0;
    let moveCount = 0;
    let bestScores = Array(10).fill(null);
    let gameState = {
      playerPos: {x: 0, y: 0},
      boxes: [],
      targets: []
    };

    // åˆå§‹åŒ–æ¸¸æˆ
    function initGame() {
      const level = levels[currentLevel];
      const gameBoard = document.getElementById('game-board');
      gameBoard.innerHTML = '';
      gameBoard.style.width = (level.width * 50) + 'px';
      gameBoard.style.height = (level.height * 50) + 'px';

      document.getElementById('current-level').textContent = currentLevel + 1;
      document.getElementById('level-select').value = currentLevel;
      document.getElementById('message').style.display = 'none';
      moveCount = 0;
      updateMoveCounter();
      updateBestScore();

      // é‡ç½®æ¸¸æˆçŠ¶æ€
      gameState.boxes = [];
      gameState.targets = [];

      // è§£æåœ°å›¾
      for (let y = 0; y < level.height; y++) {
        const rowDiv = document.createElement('div');
        rowDiv.className = 'row';
        
        for (let x = 0; x < level.width; x++) {
          const cell = document.createElement('div');
          cell.className = 'cell floor';
          cell.id = `cell-${x}-${y}`;
          
          const char = level.map[y][x];
          switch (char) {
            case '#': cell.classList.add('wall'); break;
            case '@': 
              gameState.playerPos = {x, y};
              cell.classList.add('player');
              break;
            case '$': 
              gameState.boxes.push({x, y});
              cell.classList.add('box');
              break;
            case '*': 
              gameState.targets.push({x, y});
              cell.classList.add('target');
              break;
          }
          
          rowDiv.appendChild(cell);
        }
        gameBoard.appendChild(rowDiv);
      }
      
      renderGame();
    }

    // æ¸²æŸ“æ¸¸æˆçŠ¶æ€
    function renderGame() {
      // æ¸…é™¤æ‰€æœ‰åŠ¨æ€å…ƒç´ 
      document.querySelectorAll('.player, .box, .box-on-target').forEach(el => {
        el.classList.remove('player', 'box', 'box-on-target');
      });

      // ç»˜åˆ¶ç©å®¶
      const playerCell = document.getElementById(`cell-${gameState.playerPos.x}-${gameState.playerPos.y}`);
      if (playerCell) playerCell.classList.add('player');

      // ç»˜åˆ¶ç®±å­å’Œç›®æ ‡
      gameState.boxes.forEach(box => {
        const cell = document.getElementById(`cell-${box.x}-${box.y}`);
        if (cell) {
          if (isTarget(box.x, box.y)) {
            cell.classList.add('box-on-target');
          } else {
            cell.classList.add('box');
          }
        }
      });

      // æ£€æŸ¥èƒœåˆ©æ¡ä»¶
      if (checkWin()) {
        showMessage(`æ­å–œé€šè¿‡ ${levels[currentLevel].name} å…³å¡ï¼`);
        updateBestScore(true);
        
        setTimeout(() => {
          if (currentLevel < levels.length - 1) {
            currentLevel++;
            initGame();
          } else {
            showMessage('ğŸ‰ æ­å–œä½ é€šå…³äº†æ‰€æœ‰å…³å¡ï¼');
          }
        }, 1000);
      }
    }

    // ç§»åŠ¨ç©å®¶
    function movePlayer(dy, dx) {
      const newX = gameState.playerPos.x + dx;
      const newY = gameState.playerPos.y + dy;
      
      if (isWall(newX, newY)) return;
      
      // æ£€æŸ¥æ˜¯å¦æ¨åŠ¨ç®±å­
      const boxIndex = findBox(newX, newY);
      if (boxIndex !== -1) {
        const boxNewX = newX + dx;
        const boxNewY = newY + dy;
        
        if (isWall(boxNewX, boxNewY) || findBox(boxNewX, boxNewY) !== -1) {
          return; // ä¸èƒ½æ¨åŠ¨
        }
        
        // ç§»åŠ¨ç®±å­
        gameState.boxes[boxIndex] = {x: boxNewX, y: boxNewY};
      }
      
      // ç§»åŠ¨ç©å®¶
      gameState.playerPos = {x: newX, y: newY};
      moveCount++;
      updateMoveCounter();
      renderGame();
    }

    // è¾…åŠ©å‡½æ•°
    function isWall(x, y) {
      const cell = document.getElementById(`cell-${x}-${y}`);
      return cell && cell.classList.contains('wall');
    }

    function isTarget(x, y) {
      return gameState.targets.some(t => t.x === x && t.y === y);
    }

    function findBox(x, y) {
      return gameState.boxes.findIndex(b => b.x === x && b.y === y);
    }

    function checkWin() {
      return gameState.targets.every(target => {
        return gameState.boxes.some(box => {
          return box.x === target.x && box.y === target.y;
        });
      });
    }

    function resetLevel() {
      initGame();
    }

    function changeLevel() {
      currentLevel = parseInt(document.getElementById('level-select').value);
      initGame();
    }

    function showMessage(msg) {
      const messageEl = document.getElementById('message');
      messageEl.textContent = msg;
      messageEl.style.display = 'block';
    }

    function updateMoveCounter() {
      document.getElementById('move-count').textContent = moveCount;
    }

    function updateBestScore(isWin = false) {
      if (isWin && (bestScores[currentLevel] === null || moveCount < bestScores[currentLevel])) {
        bestScores[currentLevel] = moveCount;
      }
      
      const bestScoreEl = document.getElementById('best-score');
      bestScoreEl.textContent = bestScores[currentLevel] !== null ? bestScores[currentLevel] : '-';
    }

    // é”®ç›˜æ§åˆ¶
    document.addEventListener('keydown', (e) => {
      switch (e.key) {
        case 'ArrowUp': case 'w': case 'W': movePlayer(-1, 0); break;
        case 'ArrowDown': case 's': case 'S': movePlayer(1, 0); break;
        case 'ArrowLeft': case 'a': case 'A': movePlayer(0, -1); break;
        case 'ArrowRight': case 'd': case 'D': movePlayer(0, 1); break;
        case 'r': case 'R': resetLevel(); break;
      }
    });

    // åˆå§‹åŒ–æ¸¸æˆ
    window.onload = initGame;
  </script>
</body>
</html>
